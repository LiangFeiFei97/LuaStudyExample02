---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by DELL.
--- DateTime: 2020/12/23 14:11
---

local HomeView = {}

local img_character = home_panel.transform:Find('character/Image'):GetComponent('Image')
local btn_character = home_panel.transform:Find('character/btn_backpack'):GetComponent('Button')
local backpack_panel = home_panel.transform:Find('backpack_panel').gameObject
local backpack_content = home_panel.transform:Find('backpack_panel/Viewport/Content')
local btn_quit = home_panel.transform:Find('btn_quit'):GetComponent('Button')

btn_character.onClick:AddListener(function()
    backpack_panel:SetActive(not backpack_panel.activeSelf)
end)

btn_quit.onClick:AddListener(function()
    Tips.show('确定退出?', function()
        HomeView.hide()
        LoginController.showPanel()
    end, true)
end)

-- backpack init
HomeView.backpack = {}

for i = 1, HomeModel.itemCount do
    local item = CS.UnityEngine.Resources.Load('Prefabs/backpack_item', typeof(CS.UnityEngine.GameObject))
    local backpack_item = CS.UnityEngine.Object.Instantiate(item, backpack_content.gameObject.transform);
    local backpack_item_content = {}
    backpack_item_content.img = backpack_item.transform:Find('img'):GetComponent('Image')
    backpack_item_content.mask = backpack_item.transform:Find('mask').gameObject
    backpack_item_content.btn = backpack_item.transform:Find('btn'):GetComponent('Button')

    table.insert(HomeView.backpack, i, backpack_item_content)

    backpack_item_content.mask:SetActive(false)
    backpack_item_content.img.sprite = CS.UnityEngine.Resources.Load('Backpack/Images/' .. i, typeof(CS.UnityEngine.Sprite))
    backpack_item_content.btn.onClick:AddListener(function()
        HomeView.backpack[HomeModel.curItemID].mask:SetActive(false)
        for k, v in pairs(HomeView.backpack) do
            if v == backpack_item_content then
                HomeModel.curItemID = k
                break
            end
        end

        img_character.sprite = HomeView.backpack[HomeModel.curItemID].img.sprite
        HomeView.backpack[HomeModel.curItemID].mask:SetActive(true)
    end)
end

img_character.sprite = HomeView.backpack[HomeModel.curItemID].img.sprite
HomeView.backpack[HomeModel.curItemID].mask:SetActive(true)

function HomeView.show()
    home_panel:SetActive(true)
end

function HomeView.hide()
    home_panel:SetActive(false)
end

return HomeView